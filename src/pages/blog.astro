---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
const posts = (await getCollection('blog')).sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---
<Layout title="Blog">
  <div class="blog-page">
    <header class="page-header">
      <h1>Blog</h1>
      <p class="post-count">{posts.length} posts</p>
    </header>

    <ul class="post-list">
      {posts.map(post => (
        <li class="post-item">
          <a href={`/blog/${post.slug}`} class="post-link">
            <div class="post-titles">
              <span class="title-en">{post.data.title.en}</span>
              {post.data.title.zh && (
                <span class="title-zh">{post.data.title.zh}</span>
              )}
            </div>
            <div class="post-meta">
              <time datetime={post.data.date.toISOString()}>
                {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
              </time>
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="post-tags">
                  {post.data.tags.slice(0, 3).map((tag: string) => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              )}
            </div>
          </a>
        </li>
      ))}
    </ul>
  </div>
</Layout>

<style>
.blog-page {
  max-width: 900px;
  margin: 0 auto;
  padding: 2rem 0;
}

.page-header {
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border);
}

.page-header h1 {
  margin-bottom: 0.25rem;
}

.post-count {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin: 0;
}

.post-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.post-item {
  margin-bottom: 0;
}

.post-link {
  display: block;
  padding: 1.25rem 1rem;
  text-decoration: none;
  border-radius: 8px;
  transition: background 0.2s;
}

.post-link:hover {
  background: var(--bg-secondary);
}

.post-titles {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  margin-bottom: 0.5rem;
}

.title-en {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text);
  line-height: 1.4;
}

.title-zh {
  font-size: 0.95rem;
  color: var(--text-secondary);
  line-height: 1.4;
}

.post-meta {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.post-meta time {
  font-size: 0.85rem;
  color: var(--text-muted);
}

.post-tags {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.tag {
  font-size: 0.75rem;
  padding: 0.2rem 0.5rem;
  background: var(--bg-secondary);
  color: var(--text-secondary);
  border-radius: 4px;
}

.post-link:hover .tag {
  background: var(--bg);
}

@media (max-width: 640px) {
  .blog-page {
    padding: 1rem 0;
  }

  .post-link {
    padding: 1rem 0.5rem;
  }

  .title-en {
    font-size: 1rem;
  }

  .title-zh {
    font-size: 0.9rem;
  }
}
</style>
