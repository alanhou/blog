---
import Layout from '../layouts/Layout.astro';
---
<Layout title="Search / 搜索">
<div class="search-container">
  <h1>Search / 搜索</h1>
  <div class="search-box">
    <input type="text" id="search-input" placeholder="Search posts... 搜索文章..." autofocus />
  </div>
  <div id="search-results" class="search-results"></div>
</div>
</Layout>

<style>
.search-container {
  max-width: 800px;
  margin: 0 auto;
}
.search-box {
  margin: 2rem 0;
}
#search-input {
  width: 100%;
  padding: 1rem;
  font-size: 1.2rem;
  border: 2px solid var(--border);
  border-radius: 8px;
  background: var(--bg);
  color: var(--text);
}
#search-input:focus {
  outline: none;
  border-color: var(--primary);
}
.search-results {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.search-result {
  padding: 1rem;
  border: 1px solid var(--border);
  border-radius: 8px;
  text-decoration: none;
  color: var(--text);
  transition: border-color 0.2s;
}
.search-result:hover {
  border-color: var(--primary);
}
.search-result h3 {
  color: var(--primary);
  margin-bottom: 0.5rem;
}
</style>

<script>
const input = document.getElementById('search-input') as HTMLInputElement;
const results = document.getElementById('search-results');

// Simple client-side search
let posts: any[] = [];

fetch('/search-index.json')
  .then(r => r.json())
  .then(data => { posts = data; })
  .catch(() => { posts = []; });

input?.addEventListener('input', () => {
  const query = input.value.toLowerCase();
  if (!query || query.length < 2) {
    results!.innerHTML = '';
    return;
  }

  const matches = posts.filter(p =>
    p.title?.toLowerCase().includes(query) ||
    p.titleZh?.toLowerCase().includes(query) ||
    p.content?.toLowerCase().includes(query)
  );

  results!.innerHTML = matches.length
    ? matches.map(p => `
        <a href="${p.url}" class="search-result">
          <h3>${p.title || p.titleZh}</h3>
          <p>${p.excerpt || ''}</p>
        </a>
      `).join('')
    : '<p>No results found / 未找到结果</p>';
});
</script>
