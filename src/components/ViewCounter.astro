---
interface Props {
  path: string;
}

const { path } = Astro.props;
const gcSite = 'alanhou';
---

<span class="view-counter" data-gc-site={gcSite} data-path={path}>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
      <circle cx="12" cy="12" r="3"/>
    </svg>
    <span class="view-count">...</span>
  </span>

<style>
  .view-counter {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    color: var(--text-secondary);
    font-size: 0.9rem;
  }
  .view-counter svg {
    flex-shrink: 0;
  }
</style>

<script>
  function initViewCounter() {
    const el = document.querySelector('.view-counter') as HTMLElement | null;
    if (!el) return;
    const site = el.dataset.gcSite;
    const path = el.dataset.path;
    if (!site || !path) { el.style.display = 'none'; return; }

    fetch(`https://${site}.goatcounter.com/counter/${encodeURIComponent(path)}.json`)
      .then(r => { if (!r.ok) throw new Error(); return r.json(); })
      .then(data => {
        const countEl = el.querySelector('.view-count');
        if (countEl) countEl.textContent = data.count_unique ?? data.count ?? '0';
      })
      .catch(() => { el.style.display = 'none'; });
  }
  document.addEventListener('DOMContentLoaded', initViewCounter);
  document.addEventListener('astro:page-load', initViewCounter);
</script>
