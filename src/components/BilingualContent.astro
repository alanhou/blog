---
interface Props {
  defaultLang?: 'en' | 'zh' | 'both';
}
const { defaultLang = 'both' } = Astro.props;
---
<div class="bilingual-content" data-default-lang={defaultLang}>
  <div class="lang-toggle">
    <button class="lang-btn" data-lang="both">Both</button>
    <button class="lang-btn" data-lang="en">English</button>
    <button class="lang-btn" data-lang="zh">中文</button>
  </div>
  <div class="content-wrapper">
    <slot />
  </div>
</div>

<style>
.bilingual-content {
  margin: 2rem 0;
}
.lang-toggle {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
}
.lang-btn {
  padding: 0.5rem 1rem;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--text);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.9rem;
}
.lang-btn:hover {
  border-color: var(--primary);
}
.lang-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}
.content-wrapper {
  display: block;
}
.content-wrapper.side-by-side {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
}
/* Elements outside language containers span full width */
.content-wrapper.side-by-side > :not(.lang-en):not(.lang-zh) {
  grid-column: 1 / -1;
}
.content-wrapper.side-by-side > .lang-en,
.content-wrapper.side-by-side > .lang-zh {
  border-left: 3px solid var(--primary);
  padding-left: 1rem;
}
@media (max-width: 768px) {
  .content-wrapper.side-by-side {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.bilingual-content').forEach(container => {
    const buttons = container.querySelectorAll('.lang-btn');
    const wrapper = container.querySelector('.content-wrapper');
    const defaultLang = container.dataset.defaultLang || 'both';

    // Get saved preference or use default
    const savedLang = localStorage.getItem('preferred-lang') || defaultLang;

    function setLanguage(lang) {
      // Update button states
      buttons.forEach(b => {
        b.classList.toggle('active', b.dataset.lang === lang);
      });

      // Update content visibility
      const enContent = wrapper?.querySelectorAll('.lang-en');
      const zhContent = wrapper?.querySelectorAll('.lang-zh');

      if (lang === 'both') {
        enContent?.forEach(el => el.style.display = '');
        zhContent?.forEach(el => el.style.display = '');
        wrapper?.classList.add('side-by-side');
      } else if (lang === 'en') {
        enContent?.forEach(el => el.style.display = '');
        zhContent?.forEach(el => el.style.display = 'none');
        wrapper?.classList.remove('side-by-side');
      } else if (lang === 'zh') {
        enContent?.forEach(el => el.style.display = 'none');
        zhContent?.forEach(el => el.style.display = '');
        wrapper?.classList.remove('side-by-side');
      }

      // Save preference
      localStorage.setItem('preferred-lang', lang);
    }

    // Set initial state
    setLanguage(savedLang);

    // Add click handlers
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        setLanguage(btn.dataset.lang);
      });
    });
  });
});
</script>
