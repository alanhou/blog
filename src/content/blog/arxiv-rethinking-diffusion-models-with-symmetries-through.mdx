---
title:
  en: "Rethinking Diffusion Models with Symmetries through Canonicalization for Molecular Graph Generation"
  zh: "通过规范化重新思考对称性扩散模型:分子图生成的新范式"
description:
  en: "A novel canonicalization approach to diffusion models that outperforms traditional equivariant architectures by training on canonical representations and recovering symmetries at generation time."
  zh: "一种新颖的扩散模型规范化方法,通过在规范表示上训练并在生成时恢复对称性,超越了传统的等变架构。"
date: 2026-02-17
tags: ["arxiv", "ai", "cs.lg", "cs.ai", "math.gr", "q-bio.bm"]
image: "/arxiv-visuals/arxiv-rethinking-diffusion-models-with-symmetries-through.png"
---

:::en
**Paper**: [2602.15022](https://arxiv.org/abs/2602.15022)
**Authors**: Cai Zhou, Zijie Chen, Zian Li, Jike Wang, Kaiyi Jiang, Pan Li, Rose Yu, Muhan Zhang, Stephen Bates, Tommi Jaakkola
**Categories**: cs.LG, cs.AI, math.GR, q-bio.BM

## Abstract

This paper introduces a paradigm shift in handling symmetries for generative models in scientific domains. Rather than enforcing equivariance through architectural constraints, the authors propose canonicalization: mapping samples to canonical representatives, training unconstrained models on this canonical slice, and recovering the full invariant distribution by applying random symmetry transforms during generation. The approach is grounded in quotient-space theory and demonstrates both theoretical superiority and practical advantages. Applied to molecular graph generation under $S_n \times SE(3)$ symmetries, canonical diffusion significantly outperforms equivariant baselines while using similar or less computation, achieving state-of-the-art results on the GEOM-DRUG dataset.

## Key Contributions

- Introduction of the canonicalization framework as an alternative to equivariant architectures for symmetry-invariant generative modeling
- Comprehensive theoretical analysis proving correctness, universality, and superior expressivity of canonical models over invariant targets
- Demonstration that canonicalization accelerates training by removing score complexity from group mixtures and reducing conditional variance in flow matching
- Novel Canon architecture combining geometric spectra-based canonicalization with mild positional encodings
- State-of-the-art performance on 3D molecular generation, particularly on the challenging GEOM-DRUG dataset with significant advantages in few-step generation

## Theoretical Framework and Methodology

The core insight of this work lies in decomposing the symmetry-invariant generation problem through the lens of quotient spaces. Given a distribution $p(x)$ invariant under group $G$, traditional approaches constrain the model architecture to respect $G$-equivariance. The canonical approach instead:

1. Defines a canonicalization function $\phi: \mathcal{X} \rightarrow \mathcal{X}/G$ that maps each sample to a unique representative in its orbit
2. Trains an unconstrained diffusion or flow model $q_\theta$ on the canonical slice $\mathcal{X}/G$
3. Recovers the full distribution via $p_\theta(x) = \int_G q_\theta(\phi(g \cdot x)) dg$

The authors prove that this approach is not only correct but also more expressive than equivariant models. Specifically, they show that canonical models can represent any invariant distribution, while equivariant architectures may be fundamentally limited in their expressivity. The key theoretical results establish:

- The canonical slice $\mathcal{X}/G$ has lower intrinsic dimensionality than the full space, making it easier to model
- Training on canonical data removes the "group mixture" complexity that equivariant models must handle in their score functions
- For flow matching, canonicalization reduces the conditional variance of the velocity field, leading to more stable training

The framework is instantiated for molecular graphs with $S_n$ (permutation) and $SE(3)$ (rotation and translation) symmetries. The canonicalization uses geometric spectra—eigenvalues and eigenvectors of graph Laplacians and distance matrices—to establish canonical orderings and orientations that are provably unique up to discrete ambiguities.

## Experimental Results and Performance

The empirical validation focuses on 3D molecular generation tasks, comparing canonical diffusion against strong equivariant baselines including EDM, GeoLDM, and other state-of-the-art methods. Key findings include:

On the QM9 dataset, canonical diffusion achieves comparable or superior performance to equivariant models across all molecular property metrics (validity, uniqueness, novelty) while using similar computational resources. The model demonstrates particular strength in generating chemically valid structures with correct bond lengths and angles.

On the more challenging GEOM-DRUG dataset containing larger, more complex drug-like molecules, the Canon architecture with CanonFlow achieves state-of-the-art results. The performance gap widens significantly in few-step generation scenarios, where canonical models maintain high quality while equivariant baselines degrade. This suggests that the simplified score landscape from canonicalization enables more efficient sampling trajectories.

Ablation studies reveal that the benefits of canonicalization are complementary to other techniques like aligned priors and optimal transport. Combining these approaches yields the best results, with each component contributing measurably to final performance.

Computational analysis shows that despite the overhead of canonicalization operations, the overall training time is competitive or even faster than equivariant models due to the simplified learning problem on the canonical slice. The inference cost is comparable, as the canonicalization and symmetry recovery steps are relatively lightweight compared to the denoising network evaluations.

## Implications and Future Directions

This work challenges the prevailing wisdom that symmetries must be baked into model architectures. The canonicalization perspective offers several advantages: simpler architectures without equivariance constraints, better theoretical properties, and improved training dynamics. The success on molecular generation suggests broad applicability to other scientific domains with symmetries.

The theoretical framework opens questions about the fundamental relationship between symmetry, expressivity, and learning efficiency in generative models. The finding that removing symmetry from the learning problem (via canonicalization) can improve results contradicts intuitions about inductive biases, suggesting that the complexity cost of equivariant architectures may outweigh their benefits in some settings.

For molecular design and drug discovery, the practical improvements are significant. Faster generation with fewer steps enables more efficient exploration of chemical space, while the improved quality of generated molecules increases the likelihood of discovering viable candidates. The framework's flexibility also allows easy integration with other advances in diffusion models and flow matching.

Future work could explore canonicalization for other symmetry groups, investigate learned canonicalization functions that adapt to data, and extend the approach to conditional generation tasks where symmetries interact with conditioning information.

## Takeaways

1. Canonicalization provides a theoretically grounded and practically effective alternative to equivariant architectures for symmetry-invariant generation
2. Training on canonical representations simplifies the learning problem by removing group mixture complexity and reducing score function variance
3. The approach achieves state-of-the-art results on molecular graph generation, particularly excelling in few-step generation scenarios
4. Canonical models are provably more expressive than equivariant models for invariant distributions, challenging conventional wisdom about symmetry inductive biases
5. The framework is complementary to other advances like aligned priors and optimal transport, enabling further performance improvements through combination
:::

:::zh
**论文**: [2602.15022](https://arxiv.org/abs/2602.15022)
**作者**: Cai Zhou, Zijie Chen, Zian Li, Jike Wang, Kaiyi Jiang, Pan Li, Rose Yu, Muhan Zhang, Stephen Bates, Tommi Jaakkola
**分类**: cs.LG, cs.AI, math.GR, q-bio.BM

## 摘要

本文在科学领域的生成模型对称性处理方面引入了范式转变。作者提出规范化方法,而非通过架构约束强制等变性:将样本映射到规范代表,在规范切片上训练无约束模型,并通过在生成时应用随机对称变换来恢复完整的不变分布。该方法基于商空间理论,展示了理论优越性和实践优势。应用于$S_n \times SE(3)$对称性下的分子图生成,规范扩散在使用相似或更少计算量的情况下显著优于等变基线,在GEOM-DRUG数据集上达到最先进结果。

## 主要贡献

- 引入规范化框架作为对称不变生成建模中等变架构的替代方案
- 全面的理论分析证明规范模型相对于不变目标的正确性、通用性和优越表达能力
- 证明规范化通过消除群混合的得分复杂性和降低流匹配中的条件方差来加速训练
- 结合基于几何谱的规范化与温和位置编码的新型Canon架构
- 在3D分子生成上达到最先进性能,特别是在具有挑战性的GEOM-DRUG数据集上,在少步生成中具有显著优势

## 理论框架与方法论

本工作的核心洞察在于通过商空间视角分解对称不变生成问题。给定在群$G$下不变的分布$p(x)$,传统方法约束模型架构以遵守$G$-等变性。规范方法则:

1. 定义规范化函数$\phi: \mathcal{X} \rightarrow \mathcal{X}/G$,将每个样本映射到其轨道中的唯一代表
2. 在规范切片$\mathcal{X}/G$上训练无约束的扩散或流模型$q_\theta$
3. 通过$p_\theta(x) = \int_G q_\theta(\phi(g \cdot x)) dg$恢复完整分布

作者证明这种方法不仅正确,而且比等变模型更具表达能力。具体而言,他们表明规范模型可以表示任何不变分布,而等变架构在表达能力上可能存在根本限制。关键理论结果确立了:

- 规范切片$\mathcal{X}/G$的内在维度低于完整空间,使其更易建模
- 在规范数据上训练消除了等变模型必须在其得分函数中处理的"群混合"复杂性
- 对于流匹配,规范化降低了速度场的条件方差,导致更稳定的训练

该框架针对具有$S_n$(置换)和$SE(3)$(旋转和平移)对称性的分子图进行实例化。规范化使用几何谱——图拉普拉斯和距离矩阵的特征值和特征向量——来建立规范排序和方向,这些在离散歧义之外是可证明唯一的。

## 实验结果与性能表现

实证验证聚焦于3D分子生成任务,将规范扩散与包括EDM、GeoLDM等强大等变基线进行比较。主要发现包括:

在QM9数据集上,规范扩散在所有分子性质指标(有效性、唯一性、新颖性)上达到与等变模型相当或更优的性能,同时使用相似的计算资源。该模型在生成具有正确键长和键角的化学有效结构方面表现出特别的优势。

在包含更大、更复杂类药物分子的更具挑战性的GEOM-DRUG数据集上,采用CanonFlow的Canon架构达到最先进结果。在少步生成场景中性能差距显著扩大,规范模型保持高质量而等变基线性能下降。这表明规范化带来的简化得分景观使得采样轨迹更加高效。

消融研究揭示规范化的益处与对齐先验和最优传输等其他技术是互补的。结合这些方法产生最佳结果,每个组件都对最终性能有可测量的贡献。

计算分析显示,尽管规范化操作有开销,但由于规范切片上的学习问题简化,整体训练时间与等变模型相当甚至更快。推理成本相当,因为规范化和对称恢复步骤相对于去噪网络评估来说相对轻量。

## 影响与未来方向

本工作挑战了对称性必须嵌入模型架构的主流观点。规范化视角提供了几个优势:无需等变约束的更简单架构、更好的理论性质以及改进的训练动态。在分子生成上的成功表明其对其他具有对称性的科学领域具有广泛适用性。

理论框架开启了关于生成模型中对称性、表达能力和学习效率之间基本关系的问题。通过规范化从学习问题中移除对称性可以改善结果的发现,与关于归纳偏置的直觉相矛盾,表明等变架构的复杂性成本在某些情况下可能超过其益处。

对于分子设计和药物发现,实际改进是显著的。更少步骤的更快生成使化学空间的探索更加高效,而生成分子质量的提高增加了发现可行候选物的可能性。该框架的灵活性还允许轻松集成扩散模型和流匹配的其他进展。

未来工作可以探索其他对称群的规范化,研究适应数据的学习规范化函数,并将该方法扩展到对称性与条件信息交互的条件生成任务。

## 要点总结

1. 规范化为对称不变生成提供了理论基础扎实且实践有效的等变架构替代方案
2. 在规范表示上训练通过消除群混合复杂性和降低得分函数方差来简化学习问题
3. 该方法在分子图生成上达到最先进结果,特别是在少步生成场景中表现出色
4. 规范模型对于不变分布可证明比等变模型更具表达能力,挑战了关于对称归纳偏置的传统观念
5. 该框架与对齐先验和最优传输等其他进展互补,通过组合实现进一步的性能提升
:::
